#!/bin/bash

# Play/pause Spotify button
#
# by Aleksei Sotnikov (asotnikov.100@gmail.com) 
# thanks for contribution by Doug Cotler (dcotler@seas.upenn.edu)
# metadata
# <xbar.title>Spotify play/pause button</xbar.title>
# <xbar.version>v1.1</xbar.version>
# <xbar.author>Aleksei Sotnikov</xbar.author>
# <xbar.author.github>alekseysotnikov</xbar.author.github>
# <xbar.desc>Play or pause Spotify in one click</xbar.desc>
# <xbar.image>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</xbar.image>
# <xbar.dependencies>bash</xbar.dependencies>

function tellspotify() {
  osascript -e "tell application \"Spotify\" to $1"
}

case "$1" in
  'playpause' )
    tellspotify "$1"
    exit
esac

state=$(tellspotify 'player state as string');

if [ "$state" = "playing" ]; then
  state_icon="❚❚"
else
  state_icon="▶"
fi

echo "$state_icon | bash='$0' param1=playpause terminal=false refresh=false"