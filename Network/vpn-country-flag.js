#!/usr/bin/env /usr/local/bin/node

/*
    <xbar.title>VPN Country Flag</xbar.title>
    <xbar.version>v0.1</xbar.version>
    <xbar.author>Miguel Laginha</xbar.author>
    <xbar.author.github>brecke</xbar.author.github>
    <xbar.desc>It shows the country flag corresponding to your IP Address (useful when using VPNs).</xbar.desc>
    <xbar.image>iVBORw0KGgoAAAANSUhEUgAAAEYAAAAsCAYAAADYQc64AAAMFWlDQ1BJQ0MgUHJvZmlsZQAASImVVwdUk8kWnr+kEBJaIAJSQu9IrwKhgyAgHWyEJEAoARKCih1dVHDtYsGKroIouhZAFhsWLCwC9vpARGVlXSxgQeVNCuj62nn3nPnny51773x3cmfODADKduy8vGxUBYAcQYEwOtiPmZiUzCR1AyKgAQWgDRTZHFGeb1RUOIAy2v9dhm4DRNLfsJHE+tfx/yqqXJ6IAwASBXEqV8TJgfg4ALgmJ09YAAChFeqNZhXkSfAAxOpCSBAAIi7B6TKsKcGpMmwttYmN9oeYBQCZymYL0wFQkvBmFnLSYRwlCUc7AZcvgHgbxN6cDDYX4ocQW+fk5EKsTIbYPPW7OOl/i5k6FpPNTh/DslykQg7gi/Ky2XP+z+X435KTLR6dwxA2aoYwJFqSM1y3qqzcMAmmQtwkSI2IhFgN4st8rtRegu9niEPi5Pb9HJE/XDPAAAAFXHZAGMQ6EDPEWXG+cuzAFkp9oT0awS8IjZXjVGFutDw+WijIjgiXx1mewQsdxTt4osCYUZs0flAoxLDS0ONFGbEJMp7ohUJ+fATEShC3i7JiwuS+j4sy/CNGbYTiaAlnY4jfpQmDomU2mGaOaDQvzJbDls4FawFjFWTEhsh8sUSeKDF8lAOXFxAo44BxeYI4OTcMVpdftNy3JC87Sm6P7eBlB0fL1hk7IiqMGfXtLIAFJlsH7Ekme1KUfK6hvIKoWBk3HAXhwB8EACYQw5YKckEm4Lf11/fDX7KRIMAGQpAOeMBGrhn1SJCOCOA3BhSBPyHiAdGYn590lAcKof7LmFb2tQFp0tFCqUcWeAZxDq6Ne+OeeDj8smBzwN1w91E/pvLorMRAYgAxhBhEtBjjwYGss2ETAv6/0YXBngezk3ARjObwLR7hGaGD8IRwi9BFuAfiwVNpFLnVTH6x8AfmTDAZdMFoQfLsUr/PDjeFrJ1xP9wL8ofccQauDWxwJ5iJL+4Dc3OG2u8Zise4fVvLH+eTsP4+H7leyVLJWc4ideyf8R+z+jGK/3drxIV92I+W2HLsGNaCncOuYE1YPWBiZ7AGrBU7JcFjlfBUWgmjs0VLuWXBOPxRG7sauz67zz/MzZbPL1kvUQFvdoFkM/jn5s0R8tMzCpi+8DTmMUMFHFtrpoOdvSsAkrNddnS8ZUjPbIRx9Zsu/ywA7qVQmf5NxzYC4OQzAOhD33RGb2C5rwHgVDtHLCyU6STHMSAAClCGu0IL6AEjYA7zcQAuwBOwQCCYBCJBLEgCM+CKZ4AcyHkWmAcWgxJQBtaAjWAr2An2gCpwCBwF9aAJnAOXwDXQDm6BB7AuesFLMACGwDCCICSEhtARLUQfMUGsEAfEDfFGApFwJBpJQlKQdESAiJF5yBKkDFmHbEV2I9XIr8hJ5BxyBelA7iHdSB/yBvmEYigVVUd1UVN0AuqG+qJhaCw6HU1H89EidCm6Ct2MVqIH0Tr0HHoNvYV2oS/RQQxgihgDM8BsMDfMH4vEkrE0TIgtwEqxcqwSq8Ua4f98A+vC+rGPOBGn40zcBtZmCB6Hc/B8fAG+Et+KV+F1+AX8Bt6ND+BfCTSCDsGK4EEIJSQS0gmzCCWEcsI+wgnCRbhveglDRCKRQTQjusJ9mUTMJM4lriRuJx4mniV2EHuIgyQSSYtkRfIiRZLYpAJSCWkL6SDpDKmT1Ev6QFYk65MdyEHkZLKAXEwuJx8gnyZ3kp+ThxVUFEwUPBQiFbgKcxRWK+xVaFS4rtCrMExRpZhRvCixlEzKYspmSi3lIuUh5a2ioqKhorviFEW+4iLFzYpHFC8rdit+pKpRLan+1GlUMXUVdT/1LPUe9S2NRjOlsWjJtALaKlo17TztMe2DEl3JVilUiau0UKlCqU6pU+mVsoKyibKv8gzlIuVy5WPK15X7VRRUTFX8VdgqC1QqVE6q3FEZVKWr2qtGquaorlQ9oHpF9YUaSc1ULVCNq7ZUbY/aebUeOkY3ovvTOfQl9L30i/RedaK6mXqoeqZ6mfoh9Tb1AQ01DSeNeI3ZGhUapzS6GBjDlBHKyGasZhxl3GZ8Gqc7znccb9yKcbXjOse91xyvydLkaZZqHta8pflJi6kVqJWltVarXuuRNq5tqT1Fe5b2Du2L2v3j1cd7jueMLx1/dPx9HVTHUidaZ67OHp1WnUFdPd1g3TzdLbrndfv1GHosvUy9DXqn9fr06fre+nz9Dfpn9P9gajB9mdnMzcwLzAEDHYMQA7HBboM2g2FDM8M4w2LDw4aPjChGbkZpRhuMmo0GjPWNJxvPM64xvm+iYOJmkmGyyaTF5L2pmWmC6TLTetMXZppmoWZFZjVmD81p5j7m+eaV5jctiBZuFlkW2y3aLVFLZ8sMywrL61aolYsV32q7VYc1wdrdWmBdaX3Hhmrja1NoU2PTbcuwDbcttq23fTXBeELyhLUTWiZ8tXO2y7bba/fAXs1+kn2xfaP9GwdLB45DhcNNR5pjkONCxwbH105WTjynHU53nenOk52XOTc7f3FxdRG61Lr0uRq7prhuc73jpu4W5bbS7bI7wd3PfaF7k/tHDxePAo+jHn952nhmeR7wfDHRbCJv4t6JPV6GXmyv3V5d3kzvFO9d3l0+Bj5sn0qfJywjFpe1j/Xc18I30/eg7ys/Oz+h3wm/9/4e/vP9zwZgAcEBpQFtgWqBcYFbAx8HGQalB9UEDQQ7B88NPhtCCAkLWRtyJ1Q3lBNaHTowyXXS/EkXwqhhMWFbw56EW4YLwxsno5MnTV4/+WGESYQgoj4SRIZGro98FGUWlR/12xTilKgpFVOeRdtHz4tuiaHHzIw5EDMU6xe7OvZBnHmcOK45Xjl+Wnx1/PuEgIR1CV2JExLnJ15L0k7iJzUkk5Ljk/clD04NnLpxau8052kl025PN5s+e/qVGdozsmecmqk8kz3zWAohJSHlQMpndiS7kj2YGpq6LXWA48/ZxHnJZXE3cPt4Xrx1vOdpXmnr0l6ke6WvT+/L8Mkoz+jn+/O38l9nhmTuzHyfFZm1P2skOyH7cA45JyXnpEBNkCW4kKuXOzu3I88qrySvK98jf2P+gDBMuE+EiKaLGgrU4TWnVWwu/kncXehdWFH4YVb8rGOzVWcLZrfOsZyzYs7zoqCiX+biczlzm+cZzFs8r3u+7/zdC5AFqQuaFxotXLqwd1HwoqrFlMVZi38vtiteV/xuScKSxqW6Sxct7fkp+KeaEqUSYcmdZZ7Ldi7Hl/OXt61wXLFlxddSbunVMruy8rLPKzkrr/5s//Pmn0dWpa1qW+2yesca4hrBmttrfdZWrVNdV7SuZ/3k9XUbmBtKN7zbOHPjlXKn8p2bKJvEm7o2h29u2GK8Zc2Wz1sztt6q8Ks4vE1n24pt77dzt3fuYO2o3am7s2znp138XXd3B++uqzStLN9D3FO459ne+L0tv7j9Ur1Pe1/Zvi/7Bfu7qqKrLlS7Vlcf0DmwugatEdf0HZx2sP1QwKGGWpva3YcZh8uOgCPiI3/8mvLr7aNhR5uPuR2rPW5yfNsJ+onSOqRuTt1AfUZ9V0NSQ8fJSSebGz0bT/xm+9v+JoOmilMap1afppxeenrkTNGZwbN5Z/vPpZ/raZ7Z/OB84vmbF6ZcaLsYdvHypaBL51t8W85c9rrcdMXjysmrblfrr7lcq2t1bj3xu/PvJ9pc2uquu15vaHdvb+yY2HG606fz3I2AG5duht68diviVsftuNt370y703WXe/fFvex7r+8X3h9+sOgh4WHpI5VH5Y91Hlf+w+Ifh7tcuk51B3S3Pol58qCH0/Pyqejp596lz2jPyp/rP69+4fCiqS+or/2PqX/0vsx7Odxf8qfqn9temb86/hfrr9aBxIHe18LXI29WvtV6u/+d07vmwajBx0M5Q8PvSz9ofaj66Pax5VPCp+fDsz6TPm/+YvGl8WvY14cjOSMjeWwhW3oVwGBD09IAeLMfAFoSvDu0A0BRkr29pILI3otSBP4Tlr3PpOICwH4WAHGLAAiHd5QdsJlATIW95OodywKoo+NYk4sozdFBFosKXzCEDyMjb3UBIDUC8EU4MjK8fWTky15I9h4AZ/Nlbz6JEOH9fpeFBLW1IqPvrDH5J9cAbFm719ChAAAACXBIWXMAABYlAAAWJQFJUiTwAAABm2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj43MDwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj40NDwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo1lLEPAAAAHGlET1QAAAACAAAAAAAAABYAAAAoAAAAFgAAABYAAAgj0aw7wwAAB+9JREFUaAXsl3twVcUdx7/nnsc9uY/cvEiiITxCpBWnmgAGQbHWgDpOlc5UyvjodLAdMPj4Q0e0jB1rq86ItIpTMfJwYKT1xVhH27Ht1JEqU2gRMUNQYkpCKJBk8gBubpJ7zn2c/nbP3fO4gXorTP/iTM7d3/5297e//Zzf/nYjzaxbYOEsjyWJBgmuLHQTh1mWBTHkbKUYfa6lmP1MpSSJ2b2z+HUSH2iPtmVvX0C6AIYgCLoeNhfAEIwLYLwR8f/cSqAcIx6xo/NL0X6upZgpv+R2vyLHcJ+8vgojfLBdOX9bidvLGc2tWkBhVa+caz6nwrsWIYuSG/bAmTC3r2PONw8oNv68gZHyDHPj3EP7x3YuzyNP+/8m0inpGeCVXXUOxwQq1MM3wK7wbh79OYFx5uQGXauO3vHSPcYdVQECO3ZVVYNeFEZRuBgBWaPdKqGyLISUlMFgbz+GBoeQyWa4NdcDYdzjCYmiZn/Dib29xL42GN83y4EREwu37LIwKIFAACXhMGrLylF72eVIoByRWCVkNUR3KA0jYxbKS0O47ZYG1NcEMfjhXpz44GMMG0l0qwH85fAX+LKz0z+1U8v3zIViS25dDDkvYLyXpSuralCs6zjMvujQIEZHRsRcvJRlGZqmUwREoYdjaJg1E98iv6ZRRNToYVSqKowlS/H424dgJE2MjpkYPplA8/zpeKhlJrSuBA4/9RuMtB9CdOGVmHL3HVBnleK5dVvR2rrRN1dhFcu/s3K1rwXG5m9Tdu8Adv2HS5fitqJyGIaBwJJFiGdMdHWewK5PjsDMSIhGi6HqER4JyYyKVbdcgW+88xaMgWFYRgqalUXfPS1Yue0AMgSGReZ9y6/GzddoSL62Cz0vbIVcX4vq+5cj0jQFp4j7x7sHsPnl59DRtrMgFm582JJ7q3dbzhsYsbUam5rxqydWw1y/CZl4AnVrfwapWsLQELDpzQ58tLcbWVquqigYS1lYe3cTZv9uM5KnEgBtJ00JoP/e+/GjjfsxtTqKJ1c3oroYiD/cipP72zHpvuUIfW8O/n0C+O0b+/DnPT0Yo49g9O1CcnB/QWBYJydO6CsL2cXCT6X53joN8cSDZ2tavuPPHsKbuejJI2o9mm+9C8+svgEjz7Zi5JN2TH/6p1CbarjTn7ZnsWXHpzjQ0Y+MJGN9ywLMfW0LDAFGDuDoylXYeiCOx1fWAr0W4g/+AqiqQPHP78V4BGjddBCvvr0XydEkgmUxxMIaEsd3ItG3j89RyA+HkVtfgWBss14QTGOHm21JRAfTi/wiGErRSyGFZ6OxYQaeXXMTSv74Pnq3/R5Vy5ch8uNmNoQ/bV8AL77+GVY012Hu6wTmdAISRQw79tXnHwMqqNs/T8Dc+ia06xYAP2ji47a/2499bUcpSkz0DcZx6rRJuchAsncnRcxntvECfgUMFgciMhwdjaetlB8xAoKwnsMgVs4GiSayaMtuxHAwkTlkREFFVQmeWrMEC41e9P5yPbQpNShf8wAwVRMWgBSQXrUO1liSbyVks1C3ERiFunwet72mkwfdPRgdGETWNED7EOlQEJnSChiVNTg0HsDGLS+ibc+fXLuulx6dK9ow7AW4YNx26ZIZVwm9q/UYtRtp+Q4NuxuvcrtOD96w6NpFaPzOMhw8No7DR4dx6uQ4vr9kDu65djLMDa/APHIMZSvuAr5d58yX+sk6SOM5MKRVpk6mpBJHZiQBMzEKk9qMZBJmKo1kykSKynQmTT5JiJTEEPrmDGzo68IbbflbKc9pZ0Y3Sti6BABfxJwZDLPg3TCs6p9EnEail2i9MVqOlsZ5qJrXAGnyFKRiZUhYKi6qrYQeoV49/aAzmBZOx8kAZeSuY0hRNEhSwHHbokXzekBCOp0mECkYFCmmmUKStlCKdOlMhi9ID+qwgipeHujBH073OTZcQXjmapgkYPjBuH0oYuY5fWy1bciJA59dtzIht+RsLg6W4I6iCkRpakWRESTHNT1It1YZAYIrkycBOpJlSrwytSuaBplell8mPpYNxjQJCIGhV4DJ0JZjeVDXi4CQTmCO4L1hOqrO+Lh+i2Zn0dQkZDchUBxcUu8H4wARFhhS38MsuSZEqygX6yW4M1qFYlmBTItVCIhCMi/pKGayTKWca5cDBIwlXQ8YiyLEoohgT5ZOqQzLKfSmCKhF/MyxMRh0FTDio1Cy5E6Rjk2nj+O9k70+T/0V4aGtFTDYThCyKFkPqT4PjGvMa8gj50YLTX65WC3G7Xo5YsEgFFqMQvcVDoZFBy2Sg5EpaljE0GDCApkiygFD0JWGy0BXYmAaHdcsKWcpn1TSMXWxhL/vHqFjOoGoCvqnwURlahzWl5145p0d2NHVwZbkLsEn+fX2MkhHfwKI+7n/Kxhm1WuMyJIFoTlbeetV16Bl1uXQOrphshxCiTOQpS3EoLAIImBqNAJ9Ujk0eqXSGNL7DtDRRBHC8hhtEWX7Y+5ElDaMtRsQ/7wT0WXfxb9mX40nNn6Eg23diFQUY9r0asxvmIyO3W9h51/fzaEQ3nnJ+HUOBFILSAIQX/nZI4Y3eywXBqbk4tm47uY7sfCKqaiLqaiQ0lAoYYY0BcFSup1VxXJHMeUDSpponIT0il/bCZmBo60y9ugj2DMq4/q5nunfb8fx5zdDrS5D+KEWvPSPQbyyfReUUAihoIxk/9+QHBA3Xz8E24pf91Vg/gMAAP//BAH08AAABaFJREFUzVhdbBRVFP5mty3ttiCmtAol+FewtrESFFqKREgrGBPTQCPEUHzQpkQoKtZAVKyJT2g0iAlGIqJglRr7oiQmmkhEiAiCTZEHNYEgP22NpS1tt7O7s9vx3Ll7Zu5Mdwv9wewkzTn3nHO/891v7r2zqVZYWGYi6aMpGQ0mVXIkmUVOEXxTFwLpmfBPycC0nAAqK+Zh26YSZGcQnA4Et76PKcMxpG3fAtwCDL/4LmJBSvh8SPdr6NjYgPV72lCQG0DNyhJUV2ZJHoNAZ9Nu9P9yCrO3bsAPgbuw48OfoPlMhLuOYLDrdJwvs1Po28xlzOQxlUoBaH1KuXYzhSkuvA3PrFmEx6tmyJbHLuDft3Yjb9lioGE1Xtl7AdXFt6K8dR8ifbRqEiaDhOnc9Dzq958FjAiCQ2HkTs/E6qoiPFWdZ+H0NB/Bpff2oKC2Gp0rVuPVnd/h4plDCF9tjy8tBYXJyb0fFctrUP3YAlQuJUH8xJXW3Lfzc+g//oyZL2/A+dJSNO06iXMXe7C74WEs+OIjhG1hfCRMA+oPnIU/FkU0GkM4HEb/QBAFM7Lx3LqHsGJZLoJtV3Cu8U0UVCxEd+16bHzpNVz561jqCrNqVQ22NzUieypxDAH93xzH1b0HMW1mPnJf34LWi8AH+45aZ9L0peGdujI8eHAvQixMmg9ddJTqD/xuC2NEwpY4uq7TDtKxsuxONG5ejjxDx+VtO5A1ZzY+9gfR3NKSusI8uXYtNtc+De30GfR+eQha3wDuqFuD7kcq8XZLO46fPI/sQCbS0v0whjUSptwSZojqYppG9wXQUVeHFz77DYgMIRoJIRIKQtcHETXCMAwDRiiC/Nxp2PhsFZaUzEHvrn34tO0Evu3pTF1hqm6fgye0bEynBcyqWorMmlX4+nwEza2nENQjCGRlIM3vo+tEgxEz8ca6B1D41Sf4p+caeqMGuqMh/D2/FK3H/8Cw3oeYMYRYVKe/MN2SUesDABKQVATSsrBkyXwsKi5C+/eHcfjcn/+HMOoFpvjxq5sjXpsPH0rzZ+G+R5ejN2c2jv7agUudgwhkT0E6HROfZsKMGbTICO0AHRX3BmC2n8DlgQF00464RuKE6Is1lsfn9yMzKxNDg0Gaxoy8CO44f4lEOX+N7C+VQJnr+VzbE2xcN6C8HBwIzrK1pokjQbuCXjBdvgH40jPoJdMZERTEW49FYA6LPyowh+1OY3dcXa8z3V3LYojdxz5bAaTNvcf7O0YCyCLyXXjOgF48PSMFElH5qG1Gi3FurNbhcv2ZI2ttdpRi31mNJUw5xz34jpJWQpxr5ZHCCN3kdHdWFCaCTRRTQG/YHdkt+dTEtTYTSrPPVmDRjkkkjAMmi2nshCwO1pCSqS2Mh7Sini0ClbBPt59doc27e7EziodNF1586UrMdmmm9NVNyNgjYCmRKMb1Y7E2g1EmjV4jmcgFMCu2AjShMCJheo6OFEs2411iAVhoqSLM6GIIvvzYu4OmsCB2jIoSCCPBrWKljyoUC2OlU0YYhSyvfhRriRCfwoKwQGIaCVOhjl1QzpEiKZS+0pXTvJewA5AMNlncmTm6pxBxFSaLu4rsAYsh7gL2VWaTJgxvSDc9tZXN6SY47q7Xa+Cwkp7z0p3MuIQRjfk4Wb6F54A6xBLdPU52MjzZdWzCuPvyfuFoHHE8R0lAqMLI2yuZCMniTGT89sZF8QrnvETpOWNmM+4dI46O3c7CdcDtOHdRa+3YxBzZzd3JYcDYSp5cHon/RPLR50ppHYQJCaOCarKbGrKJiKAk5TR2FY554NqvcsOOwIjLwGqoeRcNObDKlPikCcPHSfRnLmzVmMpvIr6yBlsYNWb9ayLeQOVhhVyFcb6eFzt5woiOCjiT8do41wkbXpvXWsCeH6eyGTMZKQT/5JB1EvE/wyszegUqlvcAAAAASUVORK5CYII=</xbar.image>
    <xbar.dependencies>node</xbar.dependencies>
    <xbar.abouturl>https://github.com/brecke/bitbar-vpn-flag</xbar.abouturl>
*/

var ipapi = require('ipapi.co');
var https = require('https');
var flag = require('country-code-emoji').flag;

var IPAddress;
https.get('https://ipapi.co/ip/', function(resp) {
    var body = '';
    resp.on('data', function(data) {
        body += data;
    });

    resp.on('end', function() {
		IPAddress = body;
	
		ipapi.location(function(country) {
			console.log(flag(country)); 
		}, IPAddress.toString(), '', 'country');
    });
});


